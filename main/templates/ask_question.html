{% extends 'base.html' %}
{% load widget_tweaks %}

{% block content %}
<!-- Bootstrap + Custom Form -->
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">

            <!-- Card Wrapper -->
            <div class="card shadow-lg border-0 rounded-4 p-4 animate__animated animate__fadeIn">
                
                <!-- Title -->
                <h2 class="text-center fw-bold mb-4 text-gradient">
                     Ask Your Question
                </h2>
                <p class="text-center text-muted mb-4">
                    Share your question with details and optional file attachments.
                </p>

                <!-- Form -->
                <form method="post" enctype="multipart/form-data" novalidate>
                    {% csrf_token %}

                    <!-- Loop through fields except file and tags -->
                    {% for field in form %}
                        {% if field.name != 'file' and field.name != 'tags' %}
                            <div class="mb-4">
                                <label for="{{ field.id_for_label }}" class="form-label fw-semibold">
                                    {{ field.label }}
                                </label>
                                {{ field|add_class:"form-control form-control-lg rounded-3" }}
                                
                                {% if field.help_text %}
                                    <div class="form-text text-muted">
                                        {{ field.help_text }}
                                    </div>
                                {% endif %}
                                
                                {% for error in field.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ error }}
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endfor %}

                    <!-- File Upload -->
                    <div class="mb-4">
                        <label for="file" class="form-label fw-semibold">
                            Attach File (PDF, Image, etc.)
                        </label>
                        <input type="file" name="file" id="file" class="form-control form-control-lg rounded-3" multiple>
                        <div class="form-text text-muted">
                            You can upload images, PDFs, Word docs, etc. (multiple files allowed).
                        </div>

                        <!-- Preview Area -->
                        <div id="filePreview" class="mt-3"></div>
                    </div>

                    <!-- Submit -->
                    <button type="submit" 
                            class="btn btn-success btn-lg w-100 py-2 rounded-3 shadow-sm animate__animated animate__pulse animate__infinite">
                        Submit Question
                    </button>
                </form>
            </div>
            <!-- End Card -->

        </div>
    </div>
</div>

<!-- File Preview Script -->
<script>
    document.getElementById('file').addEventListener('change', function(event) {
        const preview = document.getElementById('filePreview');
        preview.innerHTML = ''; // Clear previous previews
        const files = event.target.files;

        if (files.length === 0) {
            preview.innerHTML = '<p class="text-muted">No files selected.</p>';
            return;
        }

        Array.from(files).forEach(file => {
            const fileDiv = document.createElement('div');
            fileDiv.classList.add('d-flex', 'align-items-center', 'mb-2', 'p-2', 'border', 'rounded');

            // File icon / preview
            if (file.type.startsWith('image/')) {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.classList.add('me-2', 'rounded');
                img.style.width = '50px';
                img.style.height = '50px';
                img.style.objectFit = 'cover';
                fileDiv.appendChild(img);
            } else {
                const icon = document.createElement('i');
                icon.classList.add('bi', 'bi-file-earmark-text', 'me-2', 'fs-4', 'text-secondary');
                fileDiv.appendChild(icon);
            }

            // File name + size
            const info = document.createElement('div');
            info.innerHTML = `<strong>${file.name}</strong><br><small class="text-muted">${(file.size / 1024).toFixed(1)} KB</small>`;
            fileDiv.appendChild(info);

            preview.appendChild(fileDiv);
        });
    });
</script>
{% endblock %}
