{% extends 'base.html' %}
{% load static %}

{% block title %}Login & Signup | Smart HelpDesk{% endblock %}

{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>

<style>
  /* Background Blur Image */
  body::before {
    content: "";
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: url("{% static 'images/bg.jpg' %}") no-repeat center center fixed;
    background-size: cover;
    filter: blur(8px);
    z-index: -1;
  }

  /* Page wrapper with Navbar → Content → Footer */
  .page-wrapper {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  /* Center Content (Login/Signup form) */
  .content-wrapper {
    flex: 1; /* take remaining space */
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 30px 15px;
  }

  /* Auth Form Box */
  .auth-container {
    width: 500px;
    padding: 30px;
    background-color: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
    animation: fadeIn 0.7s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }

  h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #111;
  }

  input {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border: 1px solid #ccc;
    border-radius: 6px;
    background-color: #f9f9f9;
  }

  .input-group {
    position: relative;
  }

  .input-group i {
    position: absolute;
    top: 50%;
    right: 12px;
    transform: translateY(-50%);
    cursor: pointer;
    color: #555;
  }

  button {
    width: 100%;
    padding: 12px;
    background-color: #000;
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 10px;
  }

  button:hover {
    background-color: #333;
  }

  .toggle-link {
    text-align: center;
    margin-top: 16px;
    font-size: 0.9rem;
  }

  .toggle-link a {
    color: #000;
    text-decoration: underline;
    font-weight: 600;
    cursor: pointer;
  }

  .toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #333;
    color: #fff;
    padding: 14px 20px;
    border-radius: 8px;
    opacity: 0;
    transform: translateY(-20px);
    transition: all 0.5s ease;
    z-index: 9999;
  }

  .toast.show { opacity: 1; transform: translateY(0); }
  .hidden { display: none; }
  .error { color: red; font-size: 14px; margin-top: 8px; }
</style>

<div class="page-wrapper">
  <!-- Content Center -->
  <div class="content-wrapper">
    <div class="auth-container">
      <h2 id="form-title">Login</h2>

      {% if messages %}
        {% for message in messages %}
          <script> window.onload = () => showToast("{{ message|escapejs }}"); </script>
        {% endfor %}
      {% endif %}

      <!-- Login Form -->
      <form method="POST" id="login-form" onsubmit="return validateLoginForm();">
        {% csrf_token %}
        <input type="text" name="username" id="login-username" placeholder="Username" required />
        <div class="input-group">
          <input type="password" name="password" id="login-password" placeholder="Password" required />
          <i class="fa fa-eye" onclick="togglePassword('login-password', this)"></i>
        </div>
        <button type="submit">Login</button>
        <div class="toggle-link">
          Don't have an account? <a onclick="toggleForms()">Sign up</a>
        </div>
      </form>

      <!-- Signup Form -->
      <form method="POST" id="signup-form" class="hidden" onsubmit="return validateSignupForm();">
        {% csrf_token %}
        <input type="text" name="username" id="signup-username" placeholder="Username" required />
        <input type="email" name="email" id="signup-email" placeholder="Email Address" required />
        <input type="text" name="phone" id="signup-phone" placeholder="Phone Number" required />
        <div class="input-group">
          <input type="password" name="password1" id="signup-password1" placeholder="Password" required />
          <i class="fa fa-eye" onclick="togglePassword('signup-password1', this)"></i>
        </div>
        <div class="input-group">
          <input type="password" name="password2" id="signup-password2" placeholder="Confirm Password" required />
          <i class="fa fa-eye" onclick="togglePassword('signup-password2', this)"></i>
        </div>
        <button type="submit">Sign Up</button>
        <div class="toggle-link">
          Already have an account? <a onclick="toggleForms()">Login</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>
</div>

<script>
  function toggleForms() {
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');
    const title = document.getElementById('form-title');

    if (loginForm.classList.contains('hidden')) {
      loginForm.classList.remove('hidden');
      signupForm.classList.add('hidden');
      title.innerText = 'Login';
    } else {
      loginForm.classList.add('hidden');
      signupForm.classList.remove('hidden');
      title.innerText = 'Sign Up';
    }
  }

  function togglePassword(inputId, icon) {
    const input = document.getElementById(inputId);
    const type = input.getAttribute("type") === "password" ? "text" : "password";
    input.setAttribute("type", type);
    icon.classList.toggle("fa-eye-slash");
  }

  function showToast(message) {
    const toast = document.getElementById("toast");
    toast.textContent = message;
    toast.classList.add("show");
    setTimeout(() => { toast.classList.remove("show"); }, 3000);
  }

  function validateLoginForm() {
    const username = document.getElementById("login-username").value.trim();
    const password = document.getElementById("login-password").value;
    if (!username || !password) {
      showToast("Please fill all login fields.");
      return false;
    }
    return true;
  }

  function validateSignupForm() {
    const username = document.getElementById("signup-username").value.trim();
    const email = document.getElementById("signup-email").value.trim();
    const phone = document.getElementById("signup-phone").value.trim();
    const pass1 = document.getElementById("signup-password1").value;
    const pass2 = document.getElementById("signup-password2").value;

    if (!username || !email || !phone || !pass1 || !pass2) {
      showToast("All signup fields are required.");
      return false;
    }
    if (!/^\S+@\S+\.\S+$/.test(email)) {
      showToast("Invalid email format.");
      return false;
    }
    if (pass1 !== pass2) {
      showToast("Passwords do not match.");
      return false;
    }
    if (pass1.length < 6) {
      showToast("Password must be at least 6 characters.");
      return false;
    }
    return true;
  }
</script>
{% endblock %}
